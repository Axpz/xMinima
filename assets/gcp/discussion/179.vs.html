<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>BigQuery ä¸­çš„å—æ§æ•°æ®å…±äº«æ“ä½œæŒ‡å—</title>
  <style>
    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      background: #f9f9f9;
      padding: 2rem;
      line-height: 1.6;
      color: #333;
    }
    h1 {
      color: #0059c1;
    }
    h2 {
      margin-top: 2rem;
    }
    pre {
      background: #f1f1f1;
      padding: 1rem;
      border-left: 4px solid #0059c1;
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.8rem;
      text-align: left;
    }
    th {
      background-color: #e3f2fd;
    }
    td {
      background-color: #fff;
    }
  </style>
</head>
<body>
  <h1>BigQuery ä¸­çš„å—æ§æ•°æ®å…±äº«æ“ä½œæŒ‡å—</h1>

  <h2>ğŸ§© èƒŒæ™¯åœºæ™¯</h2>
  <p>ä½ å¸Œæœ›æ•°æ®ç§‘å­¦å›¢é˜Ÿå¯ä»¥è®¿é—®éƒ¨åˆ†ä¸šåŠ¡æ•°æ®ï¼Œä½†ä¸èƒ½è®¿é—®åŒ…å« PII çš„åŸå§‹æ•°æ®ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ï¼š</p>
  <ul>
    <li>ä½¿ç”¨è§†å›¾ï¼ˆViewï¼‰éš”ç¦»æ•°æ®</li>
    <li>ä½¿ç”¨ IAM æ§åˆ¶è®¿é—®æƒé™</li>
    <li>é¿å…ç›´æ¥æš´éœ²åŸå§‹è¡¨</li>
  </ul>

  <h2>âœ… ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸€ä¸ªæ•°æ®é›†</h2>
  <p>ç”¨äºæ•°æ®ç§‘å­¦å›¢é˜Ÿçš„æ•°æ®è®¿é—®æ§åˆ¶ã€‚</p>
  <pre><code>bq mk --dataset my_project:ds_team_dataset</code></pre>

  <h2>âœ… ç¬¬äºŒæ­¥ï¼šåˆ›å»ºè§†å›¾ï¼ˆæ’é™¤ PII å­—æ®µï¼‰</h2>
  <p>é€šè¿‡è§†å›¾é€‰æ‹©æ€§åœ°æš´éœ²æ•°æ®ï¼Œæ’é™¤æ•æ„Ÿå­—æ®µã€‚</p>
  <pre><code>CREATE VIEW ds_team_dataset.cleaned_orders AS
SELECT order_id, order_date, product_id, revenue
FROM raw_dataset.orders;</code></pre>

  <h2>âœ… ç¬¬ä¸‰æ­¥ï¼šä¸ºå›¢é˜Ÿæˆå‘˜åˆ†é…é¡¹ç›®çº§ IAM è§’è‰²</h2>
  <p>ä»…æˆäºˆä»–ä»¬æŸ¥è¯¢è§†å›¾çš„æƒé™ï¼Œè€ŒéåŸå§‹æ•°æ®é›†çš„æƒé™ã€‚</p>
  <pre><code>gcloud projects add-iam-policy-binding my_project \
  --member="user:alice@company.com" \
  --role="roles/bigquery.jobUser"</code></pre>

  <h2>âœ… ç¬¬å››æ­¥ï¼šè®¾ç½®è§†å›¾æ‰€åœ¨æ•°æ®é›†çš„è®¿é—®æƒé™</h2>
  <p>æˆäºˆç”¨æˆ·å¯¹åŒ…å«è§†å›¾çš„æ•°æ®é›†çš„è®¿é—®æƒã€‚</p>
  <p>åœ¨ BigQuery æ§åˆ¶å° â†’ æ‰¾åˆ° ds_team_dataset â†’ æƒé™ â†’ æ·»åŠ ç”¨æˆ· â†’ èµ‹äºˆ Viewer æƒé™ã€‚</p>

  <h2>âœ… ç¬¬äº”æ­¥ï¼šæˆæƒè§†å›¾è®¿é—®æºæ•°æ®é›†</h2>
  <p>è®©è§†å›¾èƒ½å¤Ÿè®¿é—® raw_dataset ä¸­çš„æ•°æ®ã€‚</p>
  <pre><code>GRANT SELECT ON DATASET raw_dataset TO "project-number@cloudservices.gserviceaccount.com";</code></pre>
  <p>æˆ–è€…ï¼š</p>
  <pre><code>bq update --view_authorized_dataset raw_dataset ds_team_dataset.cleaned_orders</code></pre>

  <h2>ğŸ§  æ€»ç»“</h2>
  <table>
    <tr>
      <th>æ­¥éª¤</th>
      <th>ç›®çš„</th>
    </tr>
    <tr>
      <td>1. åˆ›å»ºä¸“ç”¨ dataset</td>
      <td>é›†ä¸­å…±äº«æ•°æ®ã€æ§åˆ¶è®¿é—®è¾¹ç•Œ</td>
    </tr>
    <tr>
      <td>2. åˆ›å»ºè§†å›¾</td>
      <td>éšè— PIIï¼Œæ§åˆ¶å­—æ®µè®¿é—®</td>
    </tr>
    <tr>
      <td>3. åˆ†é… IAM æƒé™</td>
      <td>æˆæƒå›¢é˜Ÿä½¿ç”¨ BigQuery æŸ¥è¯¢åŠŸèƒ½</td>
    </tr>
    <tr>
      <td>4. æ§åˆ¶è§†å›¾æ•°æ®é›†è®¿é—®</td>
      <td>å…è®¸ç”¨æˆ·è®¿é—®åŒ…å«è§†å›¾çš„æ•°æ®é›†</td>
    </tr>
    <tr>
      <td>5. æˆæƒè§†å›¾è®¿é—®æºæ•°æ®</td>
      <td>è®©è§†å›¾åœ¨è¿è¡Œæ—¶èƒ½è¯»å–æ‰€éœ€æ•°æ®</td>
    </tr>
  </table>

  <p><strong>è¿™å°±æ˜¯â€œé€šè¿‡æˆæƒè§†å›¾è¿›è¡Œå—æ§æ•°æ®å…±äº«â€ï¼ˆControlled Data Sharing via Authorized Viewsï¼‰çš„ä¸€æ•´å¥—æµç¨‹ã€‚</strong></p>
</body>
</html>