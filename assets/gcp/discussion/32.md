# 关于 GCP 可抢占 VM 关闭脚本的讨论整理

---

### 🗳️ 高赞评论

#### **埃洛克** · 投票率高 · 5 年 5 个月前  
> https://cloud.google.com/compute/docs/shutdownscript...所以 C  
> ✅ 已点赞 41 次  

#### **尼廷茨** · 4 年 1 个月前  
> C、启动/关闭脚本 = 元数据  
> ✅ 已赞 4 次  

#### **维沙尔 B** · 3 年 8 个月前  
> 由于实例已经创建，选项 C 被排除。  
> `gcloud compute instances add-metadata` 命令可用于添加或更新虚拟机实例的元数据。  
> ✅ 已赞 12 次  

#### **基尼系数** · 投票率高 · 4 年 11 个月前  
> 我对答案 C 有疑问，因为问题指出“您已经创建了实例”，因此 C 也有效，但解决方案不适用于已创建的实例。  
> D 对我来说似乎是正确的。  
> 🔗 参考：https://cloud.google.com/compute/docs/shutdownscript#apply_a_shutdown_script_to_running_instances  
> ✅ 已赞 28 次  

#### **[已移除]** · 1 年 3 个月前  
> 我认为 C 应该比 D 正确  
> 🔗 https://cloud.google.com/compute/docs/shutdownscript#apply_a_shutdown_script_to_running_instances  
> ✅ 已赞 2 次  

#### **NG123** · 2 年 9 个月前  
> 我也有这种感觉，因为虚拟机已经创建好了。  
> ✅ 已赞 2 次  

#### **dsnaghxhinwtsvvmip** · 1 年 12 个月前  
> xinetd。Xinet 使得答案 D 变得毫无意义  
> ✅ 已赞 5 次  

---

### 💬 深度评论

#### **pepYash** · 4 年 5 个月前  
> 是的。正确答案应该是 D。  
> 要将关机脚本添加到正在运行的实例，请按照“将启动脚本应用于正在运行的实例”文档中的说明操作，但请将元数据键替换为以下键之一：  
> - `shutdown-script`：使用此键直接提供关机脚本内容。  
> - `shutdown-script-url`：使用此键提供关机脚本文件的 Cloud Storage 网址。  
> ✅ 已赞 4 次  

#### **pepYash**（后续）  
> 改变了我的想法。  
> 可抢占虚拟机可以随时停止和启动。有了这种灵活性，C 就没问题了。  
> ✅ 已赞 6 次  

---

### 🧵 近期观点

#### **哈利法克斯** · 最近的 1 个月 2 周前  
> **所选答案：C**  
> 即使 Linux VM 实例已经创建，选项 C 仍然是可行的。您可以使用元数据向现有实例添加关闭脚本。  
> D 非常复杂，xinetd 的使用增加了不必要的复杂性，并且可能不如简单地使用关闭脚本元数据键那么有效。  
> ✅ 已赞 1 次  

#### **罗伯特·阿诺** · 3 个月 3 周前  
> **所选答案：C**  
> “当您创建新的虚拟机实例时”意味着为时已晚，那么 C 似乎被取消资格 :( 但其他选择更糟糕？  
> ✅ 已赞 1 次  

#### **埃克拉米·埃尔纳加尔** · 4 个月 3 周前  
> **所选答案：C**  
> 1. 可抢占实例和关闭脚本：Google Cloud Platform 的可抢占实例经济高效，但可能会在短时间内终止。  
> 为了妥善处理这种情况，您需要一个在实例被抢占之前运行的关闭脚本。  
> 2. 元数据和关闭脚本：Google Cloud 允许您向实例添加自定义元数据。创建可抢占实例时，您可以添加一个关闭脚本元数据条目。  
> 此条目的值应该是您的脚本，该脚本将在实例被抢占之前自动执行。  
> ✅ 已赞 1 次  

---

### 🗨️ 其他评论

#### **巴里123456** · 5 个月 3 周前  
> **所选答案：D**  
> 不是 C。C 说的是“创建新的虚拟机实例时”。但在问题中，实例已经创建好了。因此，答案是 D。  
> D 中的“服务 URL”显然指的是云存储。  
> ✅ 已赞 1 次  

#### **斯内哈索** · 7 个月 4 周前  
> 在选项 C 和 D 中，选项 D 使用关机脚本 URL，但 URL 应该是云存储 URL，而不是 Linux 服务 URL。这让我们想到了选项 C  
> ✅ 已赞 1 次  

#### **洪德夫** · 8 个月前  
> 选择 C  
> ✅ 已赞 1 次  

#### **尼克斯19** · 9 个月 2 周前  
> C 是正确的，因为 xinetd 没有意义。  
> ✅ 已赞 1 次  

#### **利萨比萨** · 1 年 1 个月前  
> **所选答案：C**  
> GCP 中的每个虚拟机实例都可以访问元数据服务器。该服务器提供有关实例的信息，并允许您配置各种设置，包括启动和关闭脚本。  
> `shutdown-script` 指定在实例关闭时应执行的关闭脚本。  
> ✅ 已赞 2 次  

#### **ashishdwi007** · 1 年 2 个月前  
> **所选答案：C**  
> 所有其他选项都与 Linux 文件或服务相关。对于可抢占式虚拟机来说，这些操作是开销。因此，自动化此类任务是有意义的。  
> ✅ 已赞 1 次  

#### **Mo7y** · 1 年 2 个月前  
> **所选答案：C**  
> 答案要么是 C，要么是 D。我排除 D，因为 shutdown-script-url 仅适用于托管在云存储上的关机脚本。  
> D 要求您将 shutdown-script-url 用于本地托管的关机脚本，因此它不是正确答案。  
> ✅ 已赞 3 次  

#### **kip21** · 1 年 2 个月前  
> C  
> 🔗 https://cloud.google.com/compute/docs/shutdownscript  
> ✅ 已赞 1 次  

#### **谢志强** · 1 年 3 个月前  
> 答案应该是 C。  
> 🔗 参考：https://cloud.google.com/compute/docs/shutdownscript#apply_a_shutdown_script_to_running_instances  
> 关于答案 D，它不是一个选项，因为不需要触及 Linux 内部的 xinetd 服务。  
> ✅ 已赞 2 次  

#### **響鳴** · 1 年 5 个月前  
> **所选答案：D**  
> 我认为答案应该是 D，因为虚拟机已经创建  
> ✅ 已赞 1 次  

#### **阿伦_m_123** · 1 年 5 个月前  
> **所选答案：C**  
> C 是正确答案。瞧，这里有个提示：在 GCP 中，这类东西会以解决方案的形式提供给客户 —— 比如提供关机脚本。  
> GCP 不会费心让用户了解那些复杂的 Linux 知识。所以答案很简单，就是 C。  
> ✅ 已赞 1 次  

#### **武孔** · 1 年 6 个月前  
> 选项 D：创建一个关闭脚本，在 Linux 中注册为 xinetd 服务，并使用 `gcloud compute instance add-metadata` 命令将服务 URL 指定为具有键 `shutdown-script-url` 的新元数据条目的值。  
> 它不如选项 C 可靠，因为它需要在虚拟机实例上安装和配置 gcloud 命令行工具。  
> ✅ 已赞 1 次  
